//
//  ProductViewModel.swift
//  DesafioAlelo
//
//  Created by Virtual Machine on 22/11/23.
//

import UIKit

protocol ProductViewModelDelegate {
    func success()
    func fail()
}

class ProductViewModel {
    
    private var listProducts: [Product]?
    private var delegate:ProductViewModelDelegate?
    
    public func delegate(delegate:ProductViewModelDelegate?) {
        self.delegate = delegate
    }
    
    init() {
        self.fetchProductsAll()
    }
        
    func fetchProductsAll() {
        guard let url = URL(string: "https://run.mocky.io/v3/963c8527-4b08-44e9-b607-dd8721f2bb1d") else { return }
        APIClient.shared.fetchProducts(from: url) { result in
            switch result {
            case .success(let data):
                DispatchQueue.main.sync {
                    self.listProducts = data
                    self.delegate?.success()
                }
            case .failure: break
                self.delegate?.fail()
            }
        }
        
        self.listProducts = [DesafioAlelo.Product(name: "VESTIDO TRANSPASSE BOW", style: "20002605", codeColor: "20002605_613", colorSlug: "tapecaria", color: "TAPEÇARIA", onSale: false, regularPrice: "R$ 199,90", actualPrice: "R$ 199,90", discountPercentage: "", installments: "3x R$ 66,63", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20002605_615_catalog_1.jpg?1460136912", sizes: [DesafioAlelo.Size(available: false, size: "PP", sku: "5807_343_0_PP"), DesafioAlelo.Size(available: true, size: "P", sku: "5807_343_0_P"), DesafioAlelo.Size(available: true, size: "M", sku: "5807_343_0_M"), DesafioAlelo.Size(available: true, size: "G", sku: "5807_343_0_G"), DesafioAlelo.Size(available: false, size: "GG", sku: "5807_343_0_GG")]), DesafioAlelo.Product(name: "REGATA ALCINHA FOLK", style: "20002570", codeColor: "20002570_614", colorSlug: "preto", color: "PRETO", onSale: false, regularPrice: "R$ 99,90", actualPrice: "R$ 99,90", discountPercentage: "", installments: "3x R$ 33,30", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20002570_002_catalog_1.jpg?1459948578", sizes: [DesafioAlelo.Size(available: true, size: "PP", sku: "5723_40130843_0_PP"), DesafioAlelo.Size(available: true, size: "P", sku: "5723_40130843_0_P"), DesafioAlelo.Size(available: true, size: "M", sku: "5723_40130843_0_M"), DesafioAlelo.Size(available: true, size: "G", sku: "5723_40130843_0_G"), DesafioAlelo.Size(available: true, size: "GG", sku: "5723_40130843_0_GG")]), DesafioAlelo.Product(name: "TOP CROPPED SUEDE", style: "20002575", codeColor: "20002575_035", colorSlug: "caramelo", color: "CARAMELO", onSale: false, regularPrice: "R$ 129,90", actualPrice: "R$ 129,90", discountPercentage: "", installments: "3x R$ 43,30", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20002575_027_catalog_1.jpg?1459537946", sizes: [DesafioAlelo.Size(available: false, size: "PP", sku: "5733_1000054_0_PP"), DesafioAlelo.Size(available: true, size: "P", sku: "5733_1000054_0_P"), DesafioAlelo.Size(available: true, size: "M", sku: "5733_1000054_0_M"), DesafioAlelo.Size(available: true, size: "G", sku: "5733_1000054_0_G"), DesafioAlelo.Size(available: false, size: "GG", sku: "5733_1000054_0_GG")]), DesafioAlelo.Product(name: "BATA DECOTE FLUID", style: "20002581", codeColor: "20002581_614", colorSlug: "mini-folk", color: "MINI FOLK", onSale: false, regularPrice: "R$ 149,90", actualPrice: "R$ 149,90", discountPercentage: "", installments: "3x R$ 49,97", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20002581_614_catalog_1.jpg?1459536611", sizes: [DesafioAlelo.Size(available: false, size: "PP", sku: "5749_341_0_PP"), DesafioAlelo.Size(available: true, size: "P", sku: "5749_341_0_P"), DesafioAlelo.Size(available: false, size: "M", sku: "5749_341_0_M"), DesafioAlelo.Size(available: true, size: "G", sku: "5749_341_0_G"), DesafioAlelo.Size(available: true, size: "GG", sku: "5749_341_0_GG")]), DesafioAlelo.Product(name: "T-SHIRT LEATHER DULL", style: "20002602", codeColor: "20002602_027", colorSlug: "marinho", color: "MARINHO", onSale: true, regularPrice: "R$ 139,90", actualPrice: "R$ 119,90", discountPercentage: "12%", installments: "3x R$ 39,97", image: "", sizes: [DesafioAlelo.Size(available: true, size: "PP", sku: "5793_1000032_0_PP"), DesafioAlelo.Size(available: true, size: "P", sku: "5793_1000032_0_P"), DesafioAlelo.Size(available: true, size: "M", sku: "5793_1000032_0_M"), DesafioAlelo.Size(available: false, size: "G", sku: "5793_1000032_0_G"), DesafioAlelo.Size(available: false, size: "GG", sku: "5793_1000032_0_GG")]), DesafioAlelo.Product(name: "CAMISA SUEDE SPAN", style: "20002584", codeColor: "20002584_027", colorSlug: "burgundy", color: "BURGUNDY", onSale: false, regularPrice: "R$ 189,90", actualPrice: "R$ 189,90", discountPercentage: "", installments: "3x R$ 63,30", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20002584_035_catalog_1.jpg?1459947139", sizes: [DesafioAlelo.Size(available: false, size: "PP", sku: "5755_1000070_0_PP"), DesafioAlelo.Size(available: true, size: "P", sku: "5755_1000070_0_P"), DesafioAlelo.Size(available: true, size: "M", sku: "5755_1000070_0_M"), DesafioAlelo.Size(available: false, size: "G", sku: "5755_1000070_0_G"), DesafioAlelo.Size(available: false, size: "GG", sku: "5755_1000070_0_GG")]), DesafioAlelo.Product(name: "CALÇA CLASSIC PRINT", style: "20002634", codeColor: "20002634_613", colorSlug: "free-dots", color: "FREE DOTS", onSale: false, regularPrice: "R$ 159,90", actualPrice: "R$ 159,90", discountPercentage: "", installments: "3x R$ 53,30", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20002634_613_catalog_1.jpg?1459548109", sizes: [DesafioAlelo.Size(available: true, size: "36", sku: "5865_339_0_36"), DesafioAlelo.Size(available: true, size: "38", sku: "5865_339_0_38"), DesafioAlelo.Size(available: true, size: "40", sku: "5865_339_0_40"), DesafioAlelo.Size(available: true, size: "42", sku: "5865_339_0_42"), DesafioAlelo.Size(available: true, size: "44", sku: "5865_339_0_44")]), DesafioAlelo.Product(name: "REGATA ALCINHA FOLK", style: "20002570", codeColor: "20002570_612", colorSlug: "off-white", color: "OFF WHITE", onSale: false, regularPrice: "R$ 99,90", actualPrice: "R$ 99,90", discountPercentage: "", installments: "3x R$ 33,30", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20002570_029_catalog_1.jpg?1459948578", sizes: [DesafioAlelo.Size(available: true, size: "PP", sku: "5723_1000058_0_PP"), DesafioAlelo.Size(available: false, size: "P", sku: "5723_1000058_0_P"), DesafioAlelo.Size(available: true, size: "M", sku: "5723_1000058_0_M"), DesafioAlelo.Size(available: true, size: "G", sku: "5723_1000058_0_G"), DesafioAlelo.Size(available: true, size: "GG", sku: "5723_1000058_0_GG")]), DesafioAlelo.Product(name: "MACAQUINHO ALFAIATARIA PEACE", style: "20002612", codeColor: "20002612_612", colorSlug: "floral-red", color: "FLORAL RED", onSale: false, regularPrice: "R$ 149,90", actualPrice: "R$ 149,90", discountPercentage: "", installments: "3x R$ 49,97", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20002612_612_catalog_1.jpg?1459531023", sizes: [DesafioAlelo.Size(available: false, size: "PP", sku: "5819_337_0_PP"), DesafioAlelo.Size(available: true, size: "P", sku: "5819_337_0_P"), DesafioAlelo.Size(available: true, size: "M", sku: "5819_337_0_M"), DesafioAlelo.Size(available: false, size: "G", sku: "5819_337_0_G"), DesafioAlelo.Size(available: false, size: "GG", sku: "5819_337_0_GG")]), DesafioAlelo.Product(name: "BOLSA FLAP TRIANGLE", style: "20002945", codeColor: "20002945_027", colorSlug: "caramelo", color: "CARAMELO", onSale: true, regularPrice: "R$ 199,90", actualPrice: "R$ 159,90", discountPercentage: "25%", installments: "3x R$ 53,30", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20002945_027_catalog_1.jpg?1459540966", sizes: [DesafioAlelo.Size(available: true, size: "U", sku: "6559_1000054_0_U")]), DesafioAlelo.Product(name: "VESTIDO LONGO FLOAT", style: "20002606", codeColor: "20002606_612", colorSlug: "tapecaria", color: "TAPEÇARIA", onSale: false, regularPrice: "R$ 219,90", actualPrice: "R$ 219,90", discountPercentage: "", installments: "3x R$ 73,30", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20002606_615_catalog_1.jpg?1459515279", sizes: [DesafioAlelo.Size(available: true, size: "PP", sku: "5811_343_0_PP"), DesafioAlelo.Size(available: false, size: "P", sku: "5811_343_0_P"), DesafioAlelo.Size(available: true, size: "M", sku: "5811_343_0_M"), DesafioAlelo.Size(available: true, size: "G", sku: "5811_343_0_G"), DesafioAlelo.Size(available: false, size: "GG", sku: "5811_343_0_GG")]), DesafioAlelo.Product(name: "BATA DECOTE FLUID", style: "20002581", codeColor: "20002581_612", colorSlug: "bohemian-preto", color: "BOHEMIAN PRETO", onSale: false, regularPrice: "R$ 149,90", actualPrice: "R$ 149,90", discountPercentage: "", installments: "3x R$ 49,97", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20002581_611_catalog_1.jpg?1459536611", sizes: [DesafioAlelo.Size(available: false, size: "PP", sku: "5749_333_0_PP"), DesafioAlelo.Size(available: true, size: "P", sku: "5749_333_0_P"), DesafioAlelo.Size(available: true, size: "M", sku: "5749_333_0_M"), DesafioAlelo.Size(available: true, size: "G", sku: "5749_333_0_G"), DesafioAlelo.Size(available: false, size: "GG", sku: "5749_333_0_GG")]), DesafioAlelo.Product(name: "VESTIDO FRANZIDO RECORTES", style: "20001609", codeColor: "20001609_029", colorSlug: "preto", color: "PRETO", onSale: true, regularPrice: "R$ 139,90", actualPrice: "R$ 69,90", discountPercentage: "50%", installments: "2x R$ 34,95", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20001609_002_catalog_1.jpg?", sizes: [DesafioAlelo.Size(available: true, size: "PP", sku: "3627_40130843_0_PP"), DesafioAlelo.Size(available: true, size: "P", sku: "3627_40130843_0_P"), DesafioAlelo.Size(available: true, size: "M", sku: "3627_40130843_0_M"), DesafioAlelo.Size(available: false, size: "G", sku: "3627_40130843_0_G"), DesafioAlelo.Size(available: false, size: "GG", sku: "3627_40130843_0_GG")]), DesafioAlelo.Product(name: "CALÇA COMFORT TASSEL", style: "20001786", codeColor: "20001786_594", colorSlug: "paisley-gipsy-azul", color: "PAISLEY GIPSY AZUL", onSale: true, regularPrice: "R$ 139,90", actualPrice: "R$ 84,90", discountPercentage: "39%", installments: "2x R$ 42,45", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20001786_594_catalog_1.jpg?1449159646", sizes: [DesafioAlelo.Size(available: true, size: "36", sku: "4029_259_0_36"), DesafioAlelo.Size(available: true, size: "38", sku: "4029_259_0_38"), DesafioAlelo.Size(available: true, size: "40", sku: "4029_259_0_40"), DesafioAlelo.Size(available: true, size: "42", sku: "4029_259_0_42"), DesafioAlelo.Size(available: false, size: "44", sku: "4029_259_0_44")]), DesafioAlelo.Product(name: "SAIA DENIM BOTÕES", style: "20001695", codeColor: "20001695_063", colorSlug: "indigo-escuro", color: "INDIGO ESCURO", onSale: true, regularPrice: "R$ 139,90", actualPrice: "R$ 69,90", discountPercentage: "50%", installments: "2x R$ 34,95", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20001695_063_catalog_1.jpg?", sizes: [DesafioAlelo.Size(available: false, size: "36", sku: "3787_233_0_36"), DesafioAlelo.Size(available: true, size: "38", sku: "3787_233_0_38"), DesafioAlelo.Size(available: true, size: "40", sku: "3787_233_0_40"), DesafioAlelo.Size(available: true, size: "42", sku: "3787_233_0_42"), DesafioAlelo.Size(available: false, size: "44", sku: "3787_233_0_44")]), DesafioAlelo.Product(name: "BLUSA LAÇO ISTAMBUL", style: "20002600", codeColor: "20002600_293", colorSlug: "laranja-queimado", color: "LARANJA QUEIMADO", onSale: false, regularPrice: "R$ 149,90", actualPrice: "R$ 149,90", discountPercentage: "", installments: "3x R$ 49,97", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20002600_293_catalog_1.jpg?1460416037", sizes: [DesafioAlelo.Size(available: true, size: "PP", sku: "5789_311_0_PP"), DesafioAlelo.Size(available: true, size: "P", sku: "5789_311_0_P"), DesafioAlelo.Size(available: true, size: "M", sku: "5789_311_0_M"), DesafioAlelo.Size(available: false, size: "G", sku: "5789_311_0_G"), DesafioAlelo.Size(available: false, size: "GG", sku: "5789_311_0_GG")]), DesafioAlelo.Product(name: "BLUSA RIB STRIPES", style: "20002829", codeColor: "20002829_006", colorSlug: "bege", color: "BEGE", onSale: false, regularPrice: "R$ 149,90", actualPrice: "R$ 149,90", discountPercentage: "", installments: "3x R$ 49,97", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20002829_006_catalog_1.jpg?1459550820", sizes: [DesafioAlelo.Size(available: false, size: "PP", sku: "6299_1000012_0_PP"), DesafioAlelo.Size(available: true, size: "P", sku: "6299_1000012_0_P"), DesafioAlelo.Size(available: true, size: "M", sku: "6299_1000012_0_M"), DesafioAlelo.Size(available: true, size: "G", sku: "6299_1000012_0_G"), DesafioAlelo.Size(available: true, size: "GG", sku: "6299_1000012_0_GG")]), DesafioAlelo.Product(name: "CASACO WHITE FUR", style: "20002648", codeColor: "20002648_029", colorSlug: "off-white", color: "OFF-WHITE", onSale: false, regularPrice: "R$ 239,90", actualPrice: "R$ 239,90", discountPercentage: "", installments: "3x R$ 79,97", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20002648_029_catalog_1.jpg?1459552552", sizes: [DesafioAlelo.Size(available: false, size: "PP", sku: "5891_1000058_0_PP"), DesafioAlelo.Size(available: true, size: "P", sku: "5891_1000058_0_P"), DesafioAlelo.Size(available: true, size: "M", sku: "5891_1000058_0_M"), DesafioAlelo.Size(available: true, size: "G", sku: "5891_1000058_0_G"), DesafioAlelo.Size(available: false, size: "GG", sku: "5891_1000058_0_GG")]), DesafioAlelo.Product(name: "VESTIDO CURTO FESTIVAL", style: "20001684", codeColor: "20001684_587", colorSlug: "floral-vintage-vermelho", color: "FLORAL VINTAGE VERMELHO", onSale: true, regularPrice: "R$ 129,90", actualPrice: "R$ 59,90", discountPercentage: "54%", installments: "1x R$ 59,90", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20001684_585_catalog_1.jpg?", sizes: [DesafioAlelo.Size(available: false, size: "PP", sku: "3765_211_0_PP"), DesafioAlelo.Size(available: false, size: "P", sku: "3765_211_0_P"), DesafioAlelo.Size(available: false, size: "M", sku: "3765_211_0_M"), DesafioAlelo.Size(available: false, size: "G", sku: "3765_211_0_G"), DesafioAlelo.Size(available: true, size: "GG", sku: "3765_211_0_GG")]), DesafioAlelo.Product(name: "ÓCULOS DE SOL BOLD", style: "20001882", codeColor: "20001882_008", colorSlug: "marrom", color: "MARRROM", onSale: true, regularPrice: "R$ 109,90", actualPrice: "R$ 49,90", discountPercentage: "55%", installments: "1x R$ 49,90", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20001882_008_catalog_1.jpg?", sizes: [DesafioAlelo.Size(available: true, size: "U", sku: "4229_1000016_0_U")]), DesafioAlelo.Product(name: "ÓCULOS DE SOL AVIADOR VINTAGE", style: "20001883", codeColor: "20001883_019", colorSlug: "cinza", color: "CINZA", onSale: true, regularPrice: "R$ 109,90", actualPrice: "R$ 49,90", discountPercentage: "55%", installments: "1x R$ 49,90", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20001883_019_catalog_1.jpg?", sizes: [DesafioAlelo.Size(available: true, size: "U", sku: "4231_1000038_0_U")]), DesafioAlelo.Product(name: "PULSEIRA STYLISH", style: "20001913", codeColor: "20001913_009", colorSlug: "dourado", color: "dourado", onSale: false, regularPrice: "R$ 29,90", actualPrice: "R$ 29,90", discountPercentage: "", installments: "1x R$ 29,90", image: "https://d3l7rqep7l31az.cloudfront.net/images/products/20001913_009_catalog_1.jpg?", sizes: [DesafioAlelo.Size(available: true, size: "U", sku: "4279_1000018_0_U")])]
    }

    var numberOfRowsInProducts: Int {
        return listProducts?.count ?? 0
    }
    
    public func loadProducts(indexPath: IndexPath) -> Product? {
        return self.listProducts?[indexPath.row]
    }
}

